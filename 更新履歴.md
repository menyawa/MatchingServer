## 2021/07/23
---
・既にプレイヤーが存在するルームに入った際、自身に他プレイヤーの情報を通知するよう修正

・LobbyのjoinPlayerAsyncでルームへの入室処理をlock文を用いて排他制御し、ほぼ同時に入室処理が走った際に作成したルームが認識されない不具合を修正  
・LobbyのjoinPlayerAsyncで他プレイヤーに自身が入ったことを通知できていなかった問題を修正

## 2021/07/22
---
・LobbyのjoinPlayerAsyncのネストが浅くなるよう修正

## 2021/07/21
---
・Player、Roomの例外をcatchする処理を追加

## 2021/07/20
---
・PlayerのsendMyDataToOthersAsyncでのotherPlayersがnullだった場合の例外を記載

・Playerで引数でエラーが出た際、例外を投げる処理を追加  
・またそれに伴うデバッグメッセージも出力する処理を追加

・ServerのgetReceiveMessageAsyncでtry-catchの外にあったため変数が見つからないエラーが出ていた問題を修正

・MessageDataにエラー用のタイプを追加  
・ServerのrunByClientMessageProgressAsyncにdefaultのケースを追加(何もしない)

・Roomで、エラー発生時に例外を投げるような処理を追加  
・同メソッドのコメントに発生する可能性のある例外を明記  
・同メソッドにデバッグ用のエラーメッセージを追加

・メッセージを受信した際そのプレイヤーに向けて送り返す処理を削除  
・ServerのsendMessageAsync、getReceiveMessageAsyncでtry-catchを用い、WebSocketExceptionを検知してnull、もしくはfalseを返すよう修正

## 2021/07/18
---
・クライアントアプリの終了等による正常ではない切断を検知した場合(ルームIDがリセットされていない場合)に退室処理を行うよう修正

・ServerのsupportMessageAsyncの最後に接続を終了した旨を表示するようにし、クライアントアプリの終了等による強制切断も検知できるよう修正

・Serverにクライアントの接続のタスクをリストに加えるaddClientConnectingTaskを追加  
・Serverに完了したクライアントの接続のタスクをリストから削除するremoveCompleteClientConnectingTaskを追加  
・上記の両メソッドをクライアントの接続承認直後に呼び出す処理を追加  
・Serverに現在何人のクライアントが接続しているか返すgetConnectingClientCountを追加

・RoomのclientPlayerRoomExists→allPlayerIsCPUに改名  
・同メソッドの中身も逆に修正  
・Lobbyでプレイヤーを退室させる際、CPUしかルームにいなくなり次第ルームを消去するよう修正  

・Roomにクライアントのプレイヤーが存在しているかどうかを返すclientPlayerRoomExistsを追加

・RoomのchangeOpen→changeOpeningStateに改名  
・RoomのisOpened_→openingState_に改名  
・PlayerにCPUかどうかを返すisCPUを追加  
・Playerに切断時にCPUに切り替えるswitchTypeByDisconnectを追加  
・それに伴い、PlayerのTypeをprivateに修正

・RunAsync→supportMessageAsyncに改名  
・ServerでsendMessageAsyncでの送信時、Task.Runで別メソッドで送信作業を行うよう修正  
・同クラスでgetDefalutLobbyの際、FirstではなくFirstOrDefaultを使うよう修正

・awaitで返り値を待っていなかったせいでコンパイルエラーになっていた箇所を修正

・ServerのsendPlayerDataToClientをPlayerの同名メソッドに統合  
・ServerにsendMessageAsyncのMessageDataを引数に取るオーバーロードを追加  
・MessageDataにTypeに対応する文字列を取得するgetMessageTypeStrを追加  
・ServerのjoinPlayer、leavePlayer、sendMyDataToOthers等を非同期に変更

## 2021/07/17
---
・ServerのcloseAsyncが非同期で行われることを考慮し、runByClientMessageProgressAsyncを非同期メソッドに修正  
・その上で、runAsyncでawaitを用いて上記メソッドの完了を待つよう修正

・サーバ→クライアント→ゲームアプリ、またゲームアプリ→クライアント→サーバのメッセージ経由ができることを確認
・デバッグ用コメントを追加

# 2021/07/14
---
・エラーの場合にWebSocketを閉じる処理を削除  
・デバッグ用メッセージを日本語に変更、より詳細に状況を説明するよう修正  

・ServerのsendMessage→sendMessageAsyncに改名  
・同メソッドをasyncかつTaskが返り値に修正

・ServerのcloseAsyncを同期メソッドに修正  
・それに伴いcloseAsync→closeに改名  
・closeで閉じた際の理由を出力するよう修正

# 2021/07/13
---
・改めて非同期実行するメソッドの呼び出しをTask.Runを用いて書き換え

・メッセージの送受信処理、つまりServer.RunAsyncがTask.Runで行われておらず、ただ呼び出されていたため同期実行となり次の接続認証待ちがタイムアウトで戻るまでできていなかった問題を修正

・DeltaTimerにObsoleteを追加

・応答なしの時間の測定をStopWatchを用いたものに変更  
・それに伴い必要なくなったDeltaTimerを用いた処理と、応答なしの時間の出力を削除

・ルームから退出した際、もしくは切断した際にルームのインデックスをリセットするよう修正  
・webSocketを切断するcloseメソッドを追加し、それを用いて切断処理を行うよう修正  
・入室、退室、切断時にデバッグ用出力を追加  

・デバッグ用出力をDebug.WriteLineを用いる方式に修正

・ServerのRunをRunAsyncに改名  
・メインループでRunAsyncを待っていたせいで、一つ接続を終えないと次の接続待ちができていなかった問題を修正

・より見やすくするため、Serverにクライアントのアクセスを受け入れWebSocketを返すacceptClientConnecting、staticコンストラクタを追加しそこに接続受け入れと初期化の処理を分離  
・それを用いて接続受け入れを行った際に次のプレイヤーの受け入れを開始するよう修正  
・デバッグ用メッセージを各所に用意

# 2021/07/12
---
・通信間隔を0.5秒に変更

# 2021/07/11
---
・MessageDataのTypeとしてTimeOutを追加

# 2021/07/10
---
・MessageDataを他の仕様に合わせたものに修正

# 2021/07/07
---
・Serverにクライアントからのメッセージに応じた処理を行うまとめメソッドrunByClientMessageProgressを追加

・Player、Room、LobbyにToStringをオーバーライドし、詳細な情報を返すような処理を追加

# 2021/06/27
---
・LobbyのleavePlayerでも入室の際と同様に、他プレイヤーに退出した旨を通知するよう修正

# 2021/06/26
---
・RoomのgetHostPlayerIDを削除  
・Roomに指定されたIDで検索して該当プレイヤーを返すgetPlayerを追加  
・同クラスのleaveで上記メソッドを用いるよう修正

・Playerに自分以外のプレイヤーに自身のデータを送るsendMyDataToOthersを追加  
・上記メソッドを用いてLobbyでプレイヤーを入室させる際、他プレイヤーに自身が入室したと送る処理を追加  

・Roomに指定されたプレイヤー以外のプレイヤーを返すgetOtherPlayersを追加  

・Playerに渡されたプレイヤーのデータをクライアントに送るsendPlayerDataToClientを追加  
・それに伴い、フィールドにWebSocketを追加  
・また使えなくなるため、Roomの作成と同時に複数プレイヤーを入室させるコンストラクタを削除  

・Serverにクライアントにプレイヤーのデータを送る、sendPlayerDataToClientを追加

# 2021/06/25
---
・MessageDataがreadonlyかつ属性が付いていなかったため、シリアライズできていなかった問題を修正

・MessageDataにEquals、==と!=のオーバーロードを追加  
・同クラスにブランクのデータを返すgetBlankを追加  
・同クラスにブランクのデータかどうかを返すisBlankを追加

・正常に受信メッセージが受け取れていなかった問題を修正

・MessageDataにToStringを追加

・正常に経過時間の計上ができていなかったので修正

・タイムアウトした場合サーバが切断するよう修正

・DeltaTimerを非staticクラスに修正

・前フレームからの経過時間を司るDeltaTimerを追加

・サーバがMessageDataのタイプに応じた動作を行うよう修正  
・Lobbyに指定プレイヤーにルームを退出させるleavePlayerを追加

# 2021/06/24
---
・サーバ・クライアント間で送受信するメッセージの構造体MessageDataを追加

・LobbyのjoinPlayerで入ったルームのインデックスを返すよう修正

・LobbyのjoinPlayerで対戦人数の希望を考慮するよう修正  
・同メソッドで空きルームが無かった際、新たに作って入室するよう修正

・Lobbyにプレイヤーを空いているルームに入室させるjoinPlayerを追加  
・Roomにまだ入れるかどうかを確認するcanJoinを追加  
・それに伴い、同クラスのisOpened_をprivateにした上で、最大人数が入ったらfalseにするよう修正

・Serverにロビーのリスト、デフォルトロビー取得の処理を追加

・sendMessage、getReceiveMessageとしてクライアントへのメッセージの送受信の処理を追加

# 2021/06/23
---
・クラスLobbyを作成

・ElementsBaseのisCorrectをprotectedに修正

・Player、Room、ロビー(まだ作っていないが)に共通する要素をまとめたクラスElementsBaseを追加  
・同クラスをPlayer、Roomに継承させるよう修正  
・Player、Roomをsealedに修正

・PlayerにクライアントとCPUのCreateメソッドを追加  
・それに伴い、同クラスにクライアントか、CPUかのタイプを追加  
・また、RoomにPlayerがニックネームを付けることを考慮したコンストラクタを修正

・Roomにカスタムプロパティのセッター・ゲッターを追加

・RoomにchangeOpenを追加し、isOpenedを変更できるよう修正

・Roomにカスタムプロパティ、開いているかどうか、最大プレイヤー数の概念を作成  
・満室なら入室できないよう修正

・Roomにプレイヤーの入室、退室、ホストの取得を追加  
・Playerに真正なidかどうかを返すisCorrectを追加

・MainでのServer.Runの呼び出しができていなかった問題を修正  
・仮でRoom、Playerを作成

・ファイル名とクラス名が一致するよう修正  
・サーバ部分を改めてクラスServerに分離

・リポジトリを作成  
・とりあえずサンプルコードをそのまま貼り付け  